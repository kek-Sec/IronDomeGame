<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Dome Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glow-color: #00ffff;
            --rocket-color: #ff4d4d;
            --interceptor-color: #00ffff;
            --explosion-base-color: 200; /* HSL Hue for explosions */
            --background-start: #010409;
            --background-end: #0d1117;
            --text-color: #c9d1d9;
            --border-color: #30363d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--background-start);
            font-family: 'Orbitron', sans-serif;
            color: var(--text-color);
        }

        canvas {
            display: block;
            background-image: radial-gradient(circle at top, var(--background-end) 0%, var(--background-start) 70%);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #ui-container {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 2;
            pointer-events: none;
            text-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color);
        }

        .ui-box {
            background: rgba(13, 17, 23, 0.7);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        #ui-container h2 {
            font-size: 1.5em;
            font-weight: 700;
        }

        #ui-container p {
            font-size: 1.2em;
            font-weight: 400;
        }

        #modal-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--background-start);
            border: 1px solid var(--border-color);
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .modal-content h1 {
            font-size: 2.5em;
            color: var(--glow-color);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--glow-color);
        }

        .modal-content p {
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 1.1em;
        }
        
        .modal-content p.game-over-stats {
             font-size: 1.3em;
             font-weight: bold;
        }

        #start-button {
            padding: 15px 30px;
            font-size: 1.5em;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            border: 2px solid var(--glow-color);
            background: transparent;
            color: var(--glow-color);
            border-radius: 8px;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px var(--glow-color);
            box-shadow: 0 0 10px var(--glow-color) inset, 0 0 10px var(--glow-color);
            pointer-events: all;
        }

        #start-button:hover {
            background: var(--glow-color);
            color: var(--background-start);
            box-shadow: 0 0 20px var(--glow-color), 0 0 30px var(--glow-color);
        }
    </style>
</head>
<body>

    <div id="ui-container">
        <div class="ui-box">
            <h2>SCORE: <span id="score">0</span></h2>
        </div>
        <div class="ui-box">
            <h2>INTERCEPTORS: <span id="interceptor-count">20</span></h2>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="modal-container">
        <div class="modal-content">
            <h1>IRON DOME</h1>
            <p>Enemy rockets are attacking the city! Click or tap on the screen to launch an interceptor missile. Your mission is to protect the city at all costs. You have a limited number of interceptors. Good luck.</p>
            <button id="start-button">START MISSION</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Basic Setup ---
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreEl = document.getElementById('score');
            const interceptorCountEl = document.getElementById('interceptor-count');
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.querySelector('.modal-content');
            const startButton = document.getElementById('start-button');

            let width, height;
            let gameActive = false;
            let animationFrameId;

            // --- Game State & Parameters ---
            let rockets = [];
            let interceptors = [];
            let particles = [];
            let cities = [];

            let score = 0;
            let totalInterceptors = 20;
            let remainingInterceptors = totalInterceptors;
            let rocketSpawnTimer = 0;
            let rocketSpawnInterval = 120; // Lower is faster

            // --- Utility Functions ---
            const resizeCanvas = () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                createCities();
            };

            const random = (min, max) => Math.random() * (max - min) + min;

            // --- Game Object Classes ---
            class City {
                constructor(x, y, w, h) {
                    this.x = x;
                    this.y = y;
                    this.width = w;
                    this.height = h;
                    this.isDestroyed = false;
                }
                draw() {
                    if (this.isDestroyed) return;
                    ctx.fillStyle = 'rgba(0, 255, 255, 0.3)';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.7)';
                    ctx.strokeRect(this.x, this.y, this.width, this.height);
                }
            }

            class Rocket {
                constructor() {
                    this.x = random(width * 0.1, width * 0.9);
                    this.y = 0;
                    this.vx = random(-1, 1);
                    this.vy = random(1.5, 2.5);
                    this.radius = 4;
                    this.trail = [];
                }

                update() {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 20) this.trail.shift();

                    this.x += this.vx;
                    this.y += this.vy;
                }

                draw() {
                    // Draw Trail
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0]?.x, this.trail[0]?.y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.strokeStyle = `rgba(255, 77, 77, 0.5)`;
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Draw Rocket Head
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'white';
                    ctx.fill();
                    ctx.shadowColor = 'red';
                    ctx.shadowBlur = 15;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }

            class Interceptor {
                constructor(targetX, targetY) {
                    this.x = width / 2;
                    this.y = height;
                    this.targetX = targetX;
                    this.targetY = targetY;
                    this.radius = 3;
                    this.speed = 7;
                    this.trail = [];

                    const angle = Math.atan2(targetY - this.y, targetX - this.x);
                    this.vx = Math.cos(angle) * this.speed;
                    this.vy = Math.sin(angle) * this.speed;
                }

                update() {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 25) this.trail.shift();

                    this.x += this.vx;
                    this.y += this.vy;
                }

                draw() {
                     // Draw Trail
                    ctx.beginPath();
                    if (this.trail.length > 0) {
                        ctx.moveTo(this.trail[0].x, this.trail[0].y);
                        for (let i = 1; i < this.trail.length; i++) {
                            const p = this.trail[i];
                            ctx.lineTo(p.x, p.y);
                        }
                    }
                    ctx.strokeStyle = `rgba(0, 255, 255, 0.5)`;
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Draw Interceptor Head
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'white';
                    ctx.fill();
                    ctx.shadowColor = 'cyan';
                    ctx.shadowBlur = 15;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
            
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.radius = random(1, 4);
                    this.life = random(60, 100);
                    this.initialLife = this.life;
                    this.color = `hsla(${color}, 100%, 70%, 1)`;

                    const angle = random(0, Math.PI * 2);
                    const speed = random(1, 6);
                    this.vx = Math.cos(angle) * speed;
                    this.vy = Math.sin(angle) * speed;
                    this.gravity = 0.05;
                }
                
                update() {
                    this.life--;
                    this.vy += this.gravity;
                    this.x += this.vx;
                    this.y += this.vy;
                }

                draw() {
                    const alpha = this.life / this.initialLife;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * alpha, 0, Math.PI * 2);
                    ctx.fillStyle = this.color.replace('1)', `${alpha})`);
                    ctx.shadowColor = this.color;
                    ctx.shadowBlur = 10;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }


            // --- Core Game Logic ---
            function createCities() {
                cities = [];
                const cityCount = 5;
                const cityWidth = width / cityCount;
                for (let i = 0; i < cityCount; i++) {
                    const h = random(40, 100);
                    const w = cityWidth * random(0.6, 0.8);
                    const x = (i * cityWidth) + (cityWidth - w) / 2;
                    const y = height - h;
                    cities.push(new City(x, y, w, h));
                }
            }

            function createExplosion(x, y, count, baseColor) {
                for (let i = 0; i < count; i++) {
                    particles.push(new Particle(x, y, baseColor + random(-20, 20)));
                }
            }

            function launchInterceptor(e) {
                if (!gameActive || remainingInterceptors <= 0) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                interceptors.push(new Interceptor(x, y));
                remainingInterceptors--;
                updateUI();
            }

            function update() {
                // Spawn Rockets
                rocketSpawnTimer++;
                if (rocketSpawnTimer > rocketSpawnInterval) {
                    rockets.push(new Rocket());
                    rocketSpawnTimer = 0;
                    if(rocketSpawnInterval > 30) rocketSpawnInterval *= 0.99; // Get progressively harder
                }
                
                // Update Rockets
                rockets.forEach((rocket, rIndex) => {
                    rocket.update();
                    // Check collision with ground/cities
                    if (rocket.y > height - 100) { // check in city zone
                        let hitCity = false;
                        cities.forEach(city => {
                           if (!city.isDestroyed && rocket.x > city.x && rocket.x < city.x + city.width && rocket.y > city.y) {
                               city.isDestroyed = true;
                               hitCity = true;
                               createExplosion(rocket.x, rocket.y, 100, 0); // Red explosion
                           }
                        });

                        if (!hitCity && rocket.y >= height) {
                             createExplosion(rocket.x, rocket.y, 50, 0);
                        }
                        
                         if(hitCity || rocket.y >= height) {
                            rockets.splice(rIndex, 1);
                         }

                    }
                });

                // Update Interceptors & check for collisions
                interceptors.forEach((interceptor, iIndex) => {
                    interceptor.update();

                    // Check for target proximity
                    const distToTarget = Math.hypot(interceptor.x - interceptor.targetX, interceptor.y - interceptor.targetY);
                    if (distToTarget < 20) {
                        createExplosion(interceptor.x, interceptor.y, 50, 200); // Cyan explosion
                        interceptors.splice(iIndex, 1);
                    }

                    // Check collision with rockets
                    rockets.forEach((rocket, rIndex) => {
                        const dist = Math.hypot(interceptor.x - rocket.x, interceptor.y - rocket.y);
                        if (dist < 15) { // Interception radius
                            createExplosion(rocket.x, rocket.y, 100, 200);
                            rockets.splice(rIndex, 1);
                            interceptors.splice(iIndex, 1);
                            score += 100;
                            updateUI();
                        }
                    });
                });

                // Update Particles
                particles.forEach((p, index) => {
                    p.update();
                    if(p.life <= 0) particles.splice(index, 1);
                });

                // Check Game Over
                const destroyedCities = cities.filter(c => c.isDestroyed).length;
                if (destroyedCities === cities.length || (remainingInterceptors <= 0 && rockets.length > 0) ) {
                    endGame();
                }
            }

            function draw() {
                ctx.clearRect(0, 0, width, height);

                // Draw ground
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, height - 10, width, 10);
                
                // Draw cities
                cities.forEach(city => city.draw());

                // Draw Iron Dome Battery
                ctx.beginPath();
                ctx.moveTo(width / 2 - 20, height);
                ctx.lineTo(width / 2, height - 20);
                ctx.lineTo(width / 2 + 20, height);
                ctx.closePath();
                ctx.fillStyle = '#00ffff';
                ctx.fill();
                ctx.shadowColor = '#00ffff';
                ctx.shadowBlur = 10;
                ctx.fill();
                ctx.shadowBlur = 0;

                // Draw everything else
                rockets.forEach(r => r.draw());
                interceptors.forEach(i => i.draw());
                particles.forEach(p => p.draw());
            }

            function gameLoop() {
                if (!gameActive) return;
                update();
                draw();
                animationFrameId = requestAnimationFrame(gameLoop);
            }

            function updateUI() {
                scoreEl.textContent = score;
                interceptorCountEl.textContent = remainingInterceptors;
            }

            function resetGame() {
                score = 0;
                remainingInterceptors = totalInterceptors;
                rockets = [];
                interceptors = [];
                particles = [];
                rocketSpawnInterval = 120;
                createCities();
                updateUI();
            }

            function startGame() {
                resetGame();
                gameActive = true;
                modalContainer.style.display = 'none';
                gameLoop();
            }

            function endGame() {
                gameActive = false;
                cancelAnimationFrame(animationFrameId);
                
                modalContainer.style.display = 'flex';
                modalContent.innerHTML = `
                    <h1>MISSION FAILED</h1>
                    <p class="game-over-stats">FINAL SCORE: ${score}</p>
                    <p>The city has fallen or you've run out of interceptors to defend it. The war is not over.</p>
                    <button id="start-button">TRY AGAIN</button>
                `;
                // Re-add event listener to the new button
                document.getElementById('start-button').addEventListener('click', startGame);
            }


            // --- Event Listeners ---
            window.addEventListener('resize', resizeCanvas);
            canvas.addEventListener('click', launchInterceptor);
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // prevent mouse event from firing
                launchInterceptor(e.touches[0]);
            });
            startButton.addEventListener('click', startGame);

            // --- Initialisation ---
            resizeCanvas();
            updateUI();
        });
    </script>
</body>
</html>
